<!DOCTYPE html>
<html lang="en">

<head>
    <title>Menu Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="crossorigin="anonymous"></script>

</head>

<body>
    <div class="container mt-3">
        <h2>Menu</h2>
        <p>Drink</p>
        <table class="table table-bordered text-center align-middle">
            <thead>
                <tr>
                    <th>品名</th>
                    <th>單價</th>
                    <th>數量</th>
                    <th>總價</th>
                </tr>
            </thead>
            <tbody class="">
                <tr>
                    <td>
                        <h3>花茶</h3>
                        <img src="https://picsum.photos/id/1022/100/100">
                    </td>
                    <td>
                        <input class="form-control my-price" type="number" name="item1Price" id="item1Price" value="100">
                    </td>
                    <td>
                        <input class="form-control my-count" type="number" name="item1Count" id="item1Count" value="1">
                    </td>
                    <td>
                        <input class="form-control my-total" type="number" name="item1Total" id="item1Total" value="0">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3>咖啡</h3>
                        <img src="https://picsum.photos/id/1024/100/100">
                    </td>
                    <td>
                        <input class="form-control my-price" type="number" name="item2Price" id="item2Price" value="50">
                    </td>
                    <td>
                        <input class="form-control my-count" type="number" name="item2Count" id="item2Count" value="1">
                    </td>
                    <td>
                        <input class="form-control my-total" type="number" name="item2Total" id="item2Total" value="0">
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3>山泉水</h3>
                        <img src="https://picsum.photos/id/1024/100/100">
                    </td>
                    <td>
                        <input class="form-control my-price" type="number" name="item3Price" id="item3Price" value="200">
                    </td>
                    <td>
                        <input class="form-control my-count" type="number" name="item3Count" id="item3Count" value="1">
                    </td>
                    <td>
                        <input class="form-control my-total" type="number" name="item3Total" id="item3Total" value="0">
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td>Result</td>
                    <td colspan="2" class="align-middle">
                        <span id="resultS">

                        </span>
                    </td>
                    <td>
                        <button type="button" class="btn btn-success" id="resultBtn">500/8折</button>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
    <script>
        // db
        // table students
        // column name phoneDB X

        // html 
        // Id ID
        // input name name phoneInputName X
        // input id name phoneInputID X

        // js name
        //  phoneJS X

        // php name
        // phonePHP X

        //ballImg
        //ballStr
        //ballBool

        /*
        * sum()
        * 計算加總
        * > 500 打八折
        */
        function sum() {
            console.log('Sum ok');

            // 1. 抓到每個total
            // 2. sum

            let sum = 0;
            let sumText = "";
            $.each(tbodyTr, function (key, value) {
                let getThis = $(this);
                let getThisTd = getThis.find('td');
                let getTotal = Number(getThisTd.find('.my-total').val());                    
                sum += getTotal;
                if(tbodyTr.length-1 > key){
                    sumText += `${getTotal} + ` ;
                }else{
                    sumText += `${getTotal} ` ;
                }
            });
            console.log('sum',sum);
            console.log('sumText',sumText);
            let str = "";
            console.log('sum', sum);
            
            // let item1TotalValue = Number(item1Total.val());
            // let item2TotalValue = Number(item2Total.val());
            // let item3TotalValue = Number(item3Total.val());
            // sum = item1TotalValue + item2TotalValue + item3TotalValue;
            // str = "";
            // if (sum > 500) {
            //     str = `
            //     ${item1TotalValue} + ${item2TotalValue} + ${item3TotalValue} = ${sum}
            //     ---八折優惠 ${sum*0.8}----
            //     `;
            // } else {
            //     str = `
            //     ${item1TotalValue} + ${item2TotalValue} + ${item3TotalValue} = ${sum}
            //     `;
            // }
            if (sum > 500) {
                str = `
                ${sumText} =${sum}
            ---八折優惠 ${sum * 0.8}----
            `;
            } else {
                str = `
                ${sumText} =${sum}
            `;
            }
            resultS.text(str);
        }

        function changeFun() {
            console.log('changeFun ok');
            tbodyTr.each(function (key, value) {
                let getThis = $(this);
                let getThisTd = getThis.find('td');
                // getThisTd.eq(0); 圖片

                // eq
                // let getPrice = getThisTd.eq(1).find('input').val();
                // let getCount = getThisTd.eq(2).find('input').val();

                // class
                let getPrice = Number(getThisTd.find('.my-price').val());
                let getCount = Number(getThisTd.find('.my-count').val());
                getThisTd.find('.my-total').val(getPrice * getCount);

                console.log('getPrice', getPrice);
                console.log('getCount', getCount);
            });


            // let item1PriceValue = Number(item1Price.val());
            // let item1CountValue = Number(item1Count.val());
            // let item1TotalValue = item1PriceValue * item1CountValue;
            // item1Total.val(item1TotalValue);
            // let item2PriceValue = Number(item2Price.val());
            // let item2CountValue = Number(item2Count.val());
            // let item2TotalValue = item2PriceValue * item2CountValue;
            // item2Total.val(item2TotalValue);
            // let item3PriceValue = Number(item3Price.val());
            // let item3CountValue = Number(item3Count.val());
            // let item3TotalValue = item3PriceValue * item3CountValue;
            // item3Total.val(item3TotalValue);
        }

        
        // 綁定
        // const item1Price = $('#item1Price');
        // const item1Count = $('#item1Count');
        // const item1Total = $('#item1Total');

        // const item2Price = $('#item2Price');
        // const item2Count = $('#item2Count');
        // const item2Total = $('#item2Total');

        // const item3Price = $('#item3Price');
        // const item3Count = $('#item3Count');
        // const item3Total = $('#item3Total');

        const resultS = $('#resultS');
        const resultBtn = $('#resultBtn');

        const myPrice = $('.my-price');
        const myCount = $('.my-count');
        const myTotal = $('.my-total');

        // const tr = $('tr');
        // console.log('tr', tr);
        const tHeadTr = $('thead>tr');
        const tHeadTrTh = tHeadTr.find('th');

        const tbodyTr = $('tbody>tr');
        const tbodyTrTd = tbodyTr.find('td');
        console.log('tbodyTr', tbodyTr);

        tHeadTr.css('color', 'yellow');
        // find 往下一層找 find(selector)
        //  chain . . . jquery_object.jq_method.jq_method
        tHeadTrTh.eq(0).css('color', 'red');
        tHeadTrTh.eq(1).css('color', 'green');
        tHeadTrTh.eq(2).css('color', 'blue');

        console.log('item3Price', item3Price);
        console.log('resultS', resultS);
        console.log('myPrice', myPrice);
        console.log('myCount', myCount);
        console.log('myTotal', myTotal);

        resultBtn.click(function(){sum()});
        myCount.change(function(){
            myCount.css('color', '');
            $(this).css('color', 'red');
            console.log($(this));
            changeFun();
        });
        changeFun();//一開始執行一次
        
        // tbodyTr.each(function (key, value) {
        //     // console.log('key', key);
        //     // console.log('value', value);
        //     // console.log('this', this);
        //     // console.log('$(this)', $(this));
        //     let getThis = $(this);
        //     let getThisTd = getThis.find('td');
        //     // console.log('getThis', getThis);
        //     // console.log('getThisTd', getThisTd);
        //     // getThisTd.eq(0); 圖片
            
        //     // eq
        //     // let getPrice = getThisTd.eq(1).find('input').val();
        //     // let getCount = getThisTd.eq(2).find('input').val();

        //     // class
        //     let getPrice = getThisTd.find('.my-price').val();
        //     let getCount = getThisTd.find('.my-count').val();

        //     console.log('getPrice', getPrice);
        //     console.log('getCount', getCount);
        // });
    </script>

</body>

</html>